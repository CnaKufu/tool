import{_ as e,a as t,b as a,c as l,d as s}from"./uni-table.BfwA1Vue.js";import{h as i,s as o,_ as n,j as c,k as u,o as r,c as d,w as m,b as h,t as p,l as f,a as _,m as y,e as b,p as g,q as D,F as v,d as C,i as x,g as S,S as k,r as w,u as V,v as I,x as $}from"./index-BlA2gAjI.js";import{_ as R,a as K}from"./uni-forms.CLTeN3fp.js";import{_ as L}from"./uni-easyinput.BgiL-3b4.js";import{V as j}from"./uni-cloud.es.DSf9ShSp.js";import{_ as q}from"./uni-icons.4RJzTdBX.js";const N=n({name:"uni-data-select",mixins:[j.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""},placement:{type:String,default:"bottom"}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,t={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return t?e+t:e},valueCom(){return this.modelValue},textShow(){let e=this.current;return e.length>10?e.slice(0,25)+"...":e},getOffsetByPlacement(){switch(this.placement){case"top":return"bottom:calc(100% + 12px);";case"bottom":return"top:calc(100% + 12px);"}}},watch:{localdata:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.mixinDatacomResData=e)}},valueCom(e,t){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,t=100){let a=null;return function(...l){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,l)}),t)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let t;if(this.collection&&(t=this.getCache()),t||0===t)e=t;else{let t="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(t=this.mixinDatacomResData[this.defItem-1].value),e=t}(e||0===e)&&this.emit(e)}else e=this.valueCom;const t=this.mixinDatacomResData.find((t=>t.value===e));this.current=t?this.formatItemName(t):""},isDisabled(e){let t=!1;return this.mixinDatacomResData.forEach((a=>{a.value===e&&(t=a.disable)})),t},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:t,value:a,channel_code:l}=e;if(l=l?`(${l})`:"",this.format){let t="";t=this.format;for(let a in e)t=t.replace(new RegExp(`{${a}}`,"g"),e[a]);return t}return this.collection.indexOf("app-list")>0?`${t}(${a})`:t||`未命名${l}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(e=this.getCurrentCacheKey()){return(i(this.cacheKey)||{})[e]},setCache(e,t=this.getCurrentCacheKey()){let a=i(this.cacheKey)||{};a[t]=e,o(this.cacheKey,a)},removeCache(e=this.getCurrentCacheKey()){let t=i(this.cacheKey)||{};delete t[e],o(this.cacheKey,t)}}},[["render",function(e,t,a,l,s,i){const o=x,n=c(u("uni-icons"),q),w=S,V=k;return r(),d(o,{class:"uni-stat__select"},{default:m((()=>[a.label?(r(),h("span",{key:0,class:"uni-label-text hide-on-phone"},p(a.label+"："),1)):f("",!0),_(o,{class:y(["uni-stat-box",{"uni-stat__actived":s.current}])},{default:m((()=>[_(o,{class:y(["uni-select",{"uni-select--disabled":a.disabled}])},{default:m((()=>[_(o,{class:"uni-select__input-box",onClick:i.toggleSelector},{default:m((()=>[s.current?(r(),d(o,{key:0,class:"uni-select__input-text"},{default:m((()=>[b(p(i.textShow),1)])),_:1})):(r(),d(o,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:m((()=>[b(p(i.typePlaceholder),1)])),_:1})),s.current&&a.clear&&!a.disabled?(r(),d(o,{key:2,onClick:g(i.clearVal,["stop"])},{default:m((()=>[_(n,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(r(),d(o,{key:3},{default:m((()=>[_(n,{type:s.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),s.showSelector?(r(),d(o,{key:0,class:"uni-select--mask",onClick:i.toggleSelector},null,8,["onClick"])):f("",!0),s.showSelector?(r(),d(o,{key:1,class:"uni-select__selector",style:D(i.getOffsetByPlacement)},{default:m((()=>[_(o,{class:y("bottom"==a.placement?"uni-popper__arrow_bottom":"uni-popper__arrow_top")},null,8,["class"]),_(V,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:m((()=>[0===s.mixinDatacomResData.length?(r(),d(o,{key:0,class:"uni-select__selector-empty"},{default:m((()=>[_(w,null,{default:m((()=>[b(p(a.emptyTips),1)])),_:1})])),_:1})):(r(!0),h(v,{key:1},C(s.mixinDatacomResData,((e,t)=>(r(),d(o,{class:"uni-select__selector-item",key:t,onClick:t=>i.change(e)},{default:m((()=>[_(w,{class:y({"uni-select__selector__disabled":e.disable})},{default:m((()=>[b(p(i.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},8,["style"])):f("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-fe4b6be6"]]),M=n({__name:"ShelfLifeCalculator",setup(i){w(!1);let o=w({productionDate:(new Date).toISOString().slice(0,10),shelfLife:15}),n=w({productionDate:{rules:[{required:!0,errorMessage:"生产日期不能为空"},{validator:e=>e<=(new Date).toISOString().slice(0,10)||"生产日期不能晚于今天"}]},shelfLife:{rules:[{required:!0,errorMessage:"保质期不能为空"},{type:"number",min:1,errorMessage:"保质期必须大于0"}]}}),h=w(1),f=w([{value:1,text:"天"},{value:30,text:"月"}]),g=w(""),D=w(""),v=w(""),C=w(""),k=w(null),j=()=>{k.value.validate().then((e=>{let t=new Date(e.productionDate),a=e.shelfLife*h.value,l=t.getTime()+1e3*a*60*60*24,s=new Date(l),i=s.getFullYear(),o=s.getMonth()+1,n=s.getDate();g.value=`${i}年${o}月${n}日`;let c=a/2,u=(l-Date.now())/1e3/60/60/24;C.value=`${Math.round(u)}天`,u<=0?(D.value="bad",v.value="已过期"):(D.value=u>c?"good":"warning",v.value="good"===D.value?"日期未过半":"日期过半")})).catch((e=>{}))};return(i,w)=>{const q=c(u("uni-datetime-picker"),e),M=c(u("uni-forms-item"),R),O=c(u("uni-easyinput"),L),P=c(u("uni-data-select"),N),T=x,B=c(u("uni-forms"),K),G=$,A=c(u("uni-th"),t),E=c(u("uni-td"),a),U=c(u("uni-tr"),l),z=S,F=c(u("uni-table"),s);return r(),d(T,{class:"container"},{default:m((()=>[_(B,{ref_key:"form",ref:k,model:V(o),rules:V(n),"label-position":"top"},{default:m((()=>[_(M,{label:"生产日期",name:"productionDate",required:""},{default:m((()=>[_(q,{type:"date",modelValue:V(o).productionDate,"onUpdate:modelValue":w[0]||(w[0]=e=>V(o).productionDate=e)},null,8,["modelValue"])])),_:1}),_(M,{label:"保质期",name:"shelfLife",required:""},{default:m((()=>[_(T,{class:"group"},{default:m((()=>[_(O,{modelValue:V(o).shelfLife,"onUpdate:modelValue":w[1]||(w[1]=e=>V(o).shelfLife=e)},null,8,["modelValue"]),_(P,{modelValue:V(h),"onUpdate:modelValue":w[2]||(w[2]=e=>I(h)?h.value=e:h=e),localdata:V(f),clear:!1},null,8,["modelValue","localdata"])])),_:1})])),_:1})])),_:1},8,["model","rules"]),_(G,{class:"button",type:"primary",onClick:V(j)},{default:m((()=>[b("计 算")])),_:1},8,["onClick"]),_(F,null,{default:m((()=>[_(U,null,{default:m((()=>[_(A,null,{default:m((()=>[b("过期时间: ")])),_:1}),_(E,null,{default:m((()=>[b(p(V(g)),1)])),_:1})])),_:1}),_(U,null,{default:m((()=>[_(A,null,{default:m((()=>[b("提示：")])),_:1}),_(E,null,{default:m((()=>[_(z,{class:y(V(D))},{default:m((()=>[b(p(V(v)),1)])),_:1},8,["class"])])),_:1})])),_:1}),_(U,null,{default:m((()=>[_(A,null,{default:m((()=>[b("剩余天数：")])),_:1}),_(E,null,{default:m((()=>[b(p(V(C)),1)])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-f946d736"]]);export{M as default};
